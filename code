# Lab project #2094804338:AAE9vn3RGx3ZOgLELjPuTZMXUOTguDeg5iE - API ключ (токен)
import sqlite3  # Імпорт студії
import telebot  # Імпорт бібліотеки
from telebot import types  # Імпортування типів

bot = telebot.TeleBot('2094804338:AAE9vn3RGx3ZOgLELjPuTZMXUOTguDeg5iE')  # Присвоєння токену

@bot.message_handler(commands=["start"])  # Встановлення кнопки старт
@bot.message_handler(commands=["button"])  # Встановлення кнопки
def button(message):  # Функція яка визначена, тобто присвоєння змінних до днів тижню
    markup = types.InlineKeyboardMarkup(row_width=2)  # Задання кількості кнопок в 1 рядку ( 2 шт. )

    day1 = types.InlineKeyboardButton('Вівторок', callback_data='day_1')

    day2 = types.InlineKeyboardButton('Середа', callback_data='day_2')

    day3 = types.InlineKeyboardButton('Четвер', callback_data='day_3')

    day4 = types.InlineKeyboardButton("П'ятниця", callback_data='day_4')

    day5 = types.InlineKeyboardButton('Субота', callback_data='day_5')

    teachers = types.InlineKeyboardButton('Викладачі ІПЗ-13', callback_data='teachers')
    markup.add(day1, day2, day3, day4, day5, teachers)  # Надання змінним сили
    bot.send_message(message.chat.id, 'Привіт! Напиши /help - дізнайся всю інформацію, '
                                      'та підпишись на нас за допомогою команди /subscribe.',
                     reply_markup=markup)  # Повідомлення після старту


@bot.callback_query_handler(func=lambda call: True)  # Функція, що б бот видав відповідь
def callback1(call):  # Функція, яка надає боту команду відповіді на ключове слово ( КНОПКИ )
    if call.message:
        if call.data == 'day_1':
            bot.send_message(call.message.chat.id,

                             "Вівторок : \n"
                             "1.Немає \n"
                             "2.Немає \n"
                             "3.Алг. і стр данних Л3 (Викладач: Гульчук Ю.М.) \n"
                             "4. Чис. Основ прог.інженер. Л1 (Викладач: Ткачук А.А.)\nЗнам. Вища метем. Л1 (Викладач: Губаль Г.М.) \n"
                             "5.Іноземна мова Л243 (Викладач: Лобанова С. І.) \n")

        if call.data == 'day_2':
            bot.send_message(call.message.chat.id,

                             "Середа: \n"
                             "1.Чис. Іноземна мова Л249 (Викладач: Лобанова С. І.)\nЗнам. Немає \n"
                             "2.Вища матем. Л320 (Викладач: Губаль Г.М.) \n"
                             "3.Ділова укр. мова Л37 (Викладач: Тиха Л.Ю.) \n"
                             "4.Основи прог. Інженер. П18 (Викладач: Мороз С.А.)\n"
                             "5.Чис. Основи програм. П18 (Викладач: Вознюк А.В.)\nЗнам. Основи прог. Інженер. П18 (Викладач: Мороз С.А.)\n")

        if call.data == 'day_3':
            bot.send_message(call.message.chat.id,

                             "Четвер: \n"
                             "1.Чис. Алг. і стр. Данних Л301 (Викладач: Гульчук Ю.М.)\nЗнам. Алг. і стр. Данних Л3 (Викладач: Гульчук Ю.М.)\n"
                             "2. Ділова укр. Мова Л322 (Викладач: Тиха Л.Ю.) \n"
                             "3. Вища матем. Л322 (Викладач: Грінченко Л.Г.)\n"
                             "4. Немає \n"
                             "5. Немає \n")

        if call.data == 'day_4':
            bot.send_message(call.message.chat.id,

                             "П’ятниця: \n"
                             "1.Немає \n"
                             "2. Основи прог. Інженер. П220 (Викладач: Ткачук А.А.)\n"
                             "3. Основи програм. П212 (Викладач: Вознюк А.В.)\n"
                             "4. Чис. Вища матем. Л345 (Викладач: Грінченко Л.Г.)\nЗнам. Немає \n"
                             "5. Фіз. Вих. (Викладач: Коновальчук А.М.)\n")

        if call.data == 'day_5':
            bot.send_message(call.message.chat.id,

                             "Субота: \n"
                             "1.Немає \n"
                             "2. Осн.програм. П216 (Викладач: Вознюк А.В.)\n"
                             "3. Чис. Алг. Стр. Данних П216 (Викладач: Гульчук Ю.М.)\nЗнам. Алг.Стр. Данних П18 (Викладач: Гульчук Ю.М.)\n")

        if call.data == 'teachers':
            bot.send_message(call.message.chat.id,

                             "Гульчук Юрій Миколайович - Алг. Стр. Данних \n"
                             "Ткачук Анатолій Анатолійович - Основи Прог. Інженер. (Лекції)\n"
                             "Мороз Сергій Анатолійович - Основи прог. Інженер. (Практичні заняття)\n"
                             "Лобанова Світлана Іванівна - Анг. мова\n"
                             "Грінченко Любов Анатоліївна - Виш. мат (Практичні заняття)\n"
                             "Губаль Галина Миколаївна - Виш. мат (Лекції)\n"
                             "Тиха Лариса Юріївна - Ділова Укр. мова\n"
                             "Вознюк Анастасія Вадимівна - Основи програмування\n"
                             "Коновальчук Анастасія Миколаївна - Фіз. вих\n")


@bot.message_handler(commands=["subscribe"]) # Підписка на бота ( конект до БД )
def subscibe_message(message):
    bot.send_message(message.chat.id,'Ви успішно підписалися на бота')
    connect = sqlite3.connect('db.db')  # Конект бота до бази данних
    cursor = connect.cursor()
    cursor.execute("""CREATE TABLE IF NOT EXISTS subscribers_id(
        id INTEGER )""")  # Створення таблиці за допомогою кода
    connect.commit()  # Перевірка данних користувача на повторюваність
    people_id = message.chat.id
    cursor.execute(f"SELECT id FROM subscribers_id WHERE id = {people_id} ")
    data = cursor.fetchone()
    if data is not None:
        bot.send_message(message.chat.id, 'Такий користувач уже існує')  # Початок добавлення данних
    user_id = [message.chat.id]  # Id користувача
    cursor.execute("INSERT INTO subscribers_id VALUES(?);", user_id)  # Створення і внесення до таблиці
    connect.commit()


@bot.message_handler(commands=['delete'])  # Встановлення кнопки видалення, яка відповідає за видалення з БД
def delete(message):
    bot.send_message(message.chat.id,'Ви успішно відпідписалися на бота')
    connect = sqlite3.connect('db.db')  # Конект бота до бази данних
    cursor = connect.cursor()
    people_id = message.chat.id
    cursor.execute(f"DELETE FROM subscribers_id WHERE id = {people_id} ")
    connect.commit()


@bot.message_handler(content_types=['text'])  # Присвоєння реакції бота не текстові повідомлення
def get_text_messages(message):  # Повідомлення-відповідь на ключові слова ( ТЕКСТ )
    if message.text == "Розклад на вівторок":  # Список слів на яких буде реагувати бот
        bot.send_message(message.from_user.id,
                         "Вівторок : \n"
                         "1.Немає \n"
                         "2.Немає \n"
                         "3.Алг. і стр данних Л3 (Викладач: Гульчук Ю.М.) \n"
                         "4. Чис. Основ прог.інженер. Л1 (Викладач: Ткачук А.А.)\nЗнам. Вища метем. Л1 (Викладач: Губаль Г.М.) \n"
                         "5.Іноземна мова Л243 (Викладач: Лобанова С. І.) \n")

    if message.text == "/help":  # Встановлення кнопки хелп
        bot.send_message(message.from_user.id,

                         "Напиши 'Розклад ( ОБОВ'ЯЗКОВО з великої букви )"
                         " + день тижня (наприклад: Розклад на п'ятницю)' "
                         " і бот надасть всю інформацію. Так само по команді 'Викладачі'. " " /button - з'являються кнопки для зручності :)")

    if message.text == "Розклад на середу":
        bot.send_message(message.from_user.id,

                         "Середа: \n"
                         "1.Чис. Іноземна мова Л249 (Викладач: Лобанова С. І.)\nЗнам. Немає \n"
                         "2.Вища матем. Л320 (Викладач: Губаль Г.М.) \n"
                         "3.Ділова укр. мова Л37 (Викладач: Тиха Л.Ю.) \n"
                         "4.Основи прог. Інженер. П18 (Викладач: Мороз С.А.)\n"
                         "5.Чис. Основи програм. П18 (Викладач: Вознюк А.В.)\nЗнам. Основи прог. Інженер. П18 (Викладач: Мороз С.А.)\n")

    if message.text == "Розклад на четвер":
        bot.send_message(message.from_user.id,

                         "Четвер: \n"
                         "1.Чис. Алг. і стр. Данних Л301 (Викладач: Гульчук Ю.М.)\nЗнам. Алг. і стр. Данних Л3 (Викладач: Гульчук Ю.М.)\n"
                         "2. Ділова укр. Мова Л322 (Викладач: Тиха Л.Ю.) \n"
                         "3. Вища матем. Л322 (Викладач: Грінченко Л.Г.)\n"
                         "4. Немає \n"
                         "5. Немає \n")

    if message.text == "Розклад на п'ятницю":
        bot.send_message(message.from_user.id,

                         "П’ятниця: \n"
                         "1.Немає \n"
                         "2. Основи прог. Інженер. П220 (Викладач: Ткачук А.А.)\n"
                         "3. Основи програм. П212 (Викладач: Вознюк А.В.)\n"
                         "4. Чис. Вища матем. Л345 (Викладач: Грінченко Л.Г.)\nЗнам. Немає \n"
                         "5. Фіз. Вих. (Викладач: Коновальчук А.М.)\n")

    if message.text == "Розклад на суботу":
        bot.send_message(message.from_user.id,

                         "Субота: \n"
                         "1.Немає \n"
                         "2. Осн.програм. П216 (Викладач: Вознюк А.В.)\n"
                         "3. Чис. Алг. Стр. Данних П216 (Викладач: Гульчук Ю.М.)\nЗнам. Алг.Стр. Данних П18 (Викладач: Гульчук Ю.М.)\n")

    if message.text == "Викладачі ІПЗ-13":
        bot.send_message(message.from_user.id,

                         "Гульчук Юрій Миколайович - Алг. Стр. Данних \n"
                         "Ткачук Анатолій Анатолійович - Основи Прог. Інженер. (Лекції)\n"
                         "Мороз Сергій Анатолійович - Основи прог. Інженер. (Практичні заняття)\n"
                         "Лобанова Світлана Іванівна - Анг. мова\n"
                         "Грінченко Любов Анатоліївна - Виш. мат (Практичні заняття)\n"
                         "Губаль Галина Миколаївна - Виш. мат (Лекції)\n"
                         "Тиха Лариса Юріївна - Ділова Укр. мова\n"
                         "Вознюк Анастасія Вадимівна - Основи програмування\n"
                         "Коновальчук Анастасія Миколаївна - Фіз. вих\n")

bot.polling(none_stop=True,
            interval=0)  # Метод, який дає запит на нові повідомлення на бота, а в обмін - інформація

# В боті було використано базу данних. За допомогою програми SQLite було створенно таблиці з типом данних INTEGER.
# Тепер написання команди /subscribe  підписує користувача на бота тобто вносить його в базу данних .
# Я використав бібліотеку PyTelegramBotAPI, requests, bs4. Імпортував різні типи telebot.
# Застосував Reply Keyboard Markup. Надав зворотній зв'язок-відповідь, підключив кнопки до бота.
# Підключив Reply Keyboard Markup до БД, водночас задав меню кнопок до БД.
# Присвоїв реакцію бота на кнопки, текстові повідомлення, ключові слова.
# Надав боту можливість відповіді на текст, тим самим зробив альтернативу кнопкам. Користувач може юзати як кнопки,
# так і писати звичайним текстом ключові слова і бот надасть відповідь.
